<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>–ú–µ–Ω–µ–¥–∂–µ—Ä –º–µ—Ç–æ–∫ –∫ –≤–∏–¥–µ–æ</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: auto; }
    input, button { padding: 8px; font-size: 16px; margin: 4px 0; width: 100%; }
    .note { border-bottom: 1px solid #ccc; padding: 10px 0; }
    .note input { width: 60%; }
    .note button, .note a { margin-left: 10px; }
    video { width: 100%; margin-bottom: 20px; }
  </style>
</head>
<body>

<h2>üé¨ –ú–µ–Ω–µ–¥–∂–µ—Ä –º–µ—Ç–æ–∫ –∫ –≤–∏–¥–µ–æ</h2>

<input id="videoURL" placeholder="üîó –í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∏–¥–µ–æ" />
<button onclick="loadVideo()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ</button>
<video id="player" controls></video>

<label>üìù –¢–µ–º–∞ –º–µ—Ç–∫–∏:</label>
<input id="titleInput" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ö–∞—Ç–∞–ª–∏–∑–∞—Ç–æ—Ä—ã" />

<button onclick="saveNote()">üìå –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –º–µ—Ç–∫—É –ø–æ —Ç–µ–∫—É—â–µ–º—É –≤—Ä–µ–º–µ–Ω–∏</button>

<hr>

<input id="search" placeholder="üîç –ü–æ–∏—Å–∫..." oninput="renderNotes(this.value)">
<div id="notesList"></div>

<script>
  const player = document.getElementById("player");
  const titleEl = document.getElementById("titleInput");
  const urlInput = document.getElementById("videoURL");
  let notes = JSON.parse(localStorage.getItem("vid_notes") || "[]");

  function loadVideo() {
    const src = urlInput.value.trim();
    if (!src) return alert("–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –≤–∏–¥–µ–æ.");
    player.src = src;
  }

  function saveNote() {
    if (!player.src) return alert("–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –≤–∏–¥–µ–æ.");
    const sec = parseFloat(player.currentTime.toFixed(1));
    const title = titleEl.value.trim();
    if (!title) return alert("–í–≤–µ–¥–∏—Ç–µ —Ç–µ–º—É.");
    const note = {
      title,
      seconds: sec,
      src: player.src,
      created: new Date().toLocaleString()
    };
    notes.push(note);
    localStorage.setItem("vid_notes", JSON.stringify(notes));
    titleEl.value = "";
    renderNotes();
  }

  function formatTime(s) {
    const h = String(Math.floor(s / 3600)).padStart(2, '0');
    const m = String(Math.floor((s % 3600) / 60)).padStart(2, '0');
    const sec = String(Math.floor(s % 60)).padStart(2, '0');
    return `${h}:${m}:${sec}`;
  }

  function renderNotes(filter = "") {
    const list = document.getElementById("notesList");
    const q = filter.toLowerCase();
    const filtered = notes.filter(n => n.title.toLowerCase().includes(q));
    list.innerHTML = filtered.map((n, i) => `
      <div class="note">
        <input value="${n.title}" onchange="editNote(${i}, this.value)">
        <a href="#" onclick="goToNote(${i})">–ü–µ—Ä–µ–π—Ç–∏</a>
        <button onclick="deleteNote(${i})">üóë</button><br>
        <small>üïì ${n.created} | ‚è± ${formatTime(n.seconds)}</small>
      </div>
    `).join("") || "<i>–ú–µ—Ç–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</i>";
  }

  function goToNote(i) {
    const n = notes[i];
    player.src = n.src;
    player.addEventListener("loadedmetadata", function jump() {
      player.currentTime = n.seconds;
      player.play();
      player.removeEventListener("loadedmetadata", jump);
    });
  }

  function editNote(i, value) {
    notes[i].title = value;
    localStorage.setItem("vid_notes", JSON.stringify(notes));
  }

  function deleteNote(i) {
    if (confirm("–£–¥–∞–ª–∏—Ç—å –º–µ—Ç–∫—É?")) {
      notes.splice(i, 1);
      localStorage.setItem("vid_notes", JSON.stringify(notes));
      renderNotes();
    }
  }

  renderNotes();
</script>

</body>
</html>
